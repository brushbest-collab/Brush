<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<title>EVI Brush 設定</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC","Microsoft JhengHei",Arial,sans-serif;margin:24px;max-width:980px}
  h1{margin:0 0 16px;font-size:38px}
  .row{display:flex;gap:12px;margin:10px 0;align-items:flex-start;flex-wrap:wrap}
  .col{flex:1;min-width:260px}
  label{display:block;font-size:13px;color:#444;margin-bottom:6px}
  input[type="text"],input[type="number"],textarea,select{
    width:100%;box-sizing:border-box;padding:10px;border:1px solid #ccc;border-radius:8px;font-size:14px;background:#fff
  }
  textarea{height:96px;resize:vertical}
  .btn{padding:10px 14px;border:1px solid #bbb;border-radius:8px;background:#f6f8fa;cursor:pointer}
  .btn.primary{background:#2563eb;color:#fff;border-color:#1d4ed8}
  .muted{color:#666}
  #toast{margin-top:8px;color:#22863a}
  .badge{display:inline-block;background:#eef2ff;color:#3730a3;border-radius:999px;padding:2px 10px;font-size:12px;margin-left:8px}
</style>
</head>
<body>
  <h1>生成設定 <span id="presetBadge" class="badge" style="display:none"></span></h1>

  <!-- 預設樣式（下拉式選單） -->
  <div class="row">
    <div class="col">
      <label>樣式預設（選擇後會自動填入 Prompt / Negative 與建議參數）</label>
      <select id="preset">
        <option value="">— 選擇一個樣式 —</option>
        <option value="running">競速跑鞋（Studio）</option>
        <option value="basketball">籃球鞋（高筒 / 室內木地板）</option>
        <option value="trail">越野跑（戶外濕石）</option>
        <option value="lifestyle">生活鞋（極簡 / 商品攝影）</option>
        <option value="exploded">爆炸視圖（零件分解）</option>
        <option value="sketch">設計草圖（工業設計感）</option>
      </select>
    </div>
    <div class="col" style="align-self:flex-end">
      <button class="btn" id="applyPreset">套用選擇</button>
      <button class="btn" id="clearPreset">清空（回到自訂）</button>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>Prompt</label>
      <textarea id="prompt" placeholder="輸入你想生成的鞋款描述…"></textarea>
    </div>
    <div class="col">
      <label>Negative Prompt</label>
      <textarea id="neg" placeholder="不想要出現的元素…"></textarea>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>寬度 (px)</label>
      <input id="w" type="number" min="256" step="64" value="1024">
    </div>
    <div class="col">
      <label>高度 (px)</label>
      <input id="h" type="number" min="256" step="64" value="1024">
    </div>
    <div class="col">
      <label>步數 (steps)</label>
      <input id="steps" type="number" min="1" max="50" value="4">
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>CFG / Guidance</label>
      <input id="cfg" type="number" step="0.5" min="0" max="20" value="2">
    </div>
    <div class="col">
      <label>Seed（-1 隨機）</label>
      <input id="seed" type="number" value="-1">
    </div>
    <div class="col">
      <label>批次數量</label>
      <input id="batch" type="number" min="1" max="16" value="1">
    </div>
  </div>

  <div class="row">
    <div class="col">
      <label>輸出資料夾</label>
      <div class="row" style="gap:8px">
        <input id="out" type="text" placeholder="選擇輸出路徑…">
        <button class="btn" id="pick">選擇</button>
        <button class="btn" id="open">打開</button>
      </div>
      <div class="muted" style="margin-top:6px">圖片會輸出到此資料夾（僅設定；實際生成流程視你的後端/腳本接入）。</div>
    </div>
  </div>

  <div class="row" style="gap:8px;margin-top:16px">
    <button class="btn" id="back">← 返回首頁</button>
    <button class="btn" id="reset">恢復預設</button>
    <div style="flex:1"></div>
    <button class="btn primary" id="save">儲存設定</button>
  </div>

  <div id="toast"></div>

<script>
const $ = s => document.querySelector(s);
const fields = {
  prompt: $('#prompt'),
  negativePrompt: $('#neg'),
  width: $('#w'),
  height: $('#h'),
  steps: $('#steps'),
  guidance: $('#cfg'),
  seed: $('#seed'),
  batch: $('#batch'),
  outDir: $('#out')
};
const presetSel   = $('#preset');
const badge       = $('#presetBadge');

const PRESETS = {
  running: {
    name: '競速跑鞋（Studio）',
    prompt: `A modern athletic sneaker design, running style, low-top silhouette, engineered mesh + TPU frame upper, colorway neon coral & black, clean panel lines, logo-free, detailed stitching, sculpted midsole, waffle outsole pattern, product hero shot, 3/4 45-degree angle on seamless white background, professional studio lighting, soft rim light, ultra-detailed, 4k`,
    negative: `logo, brand text, watermark, caption, extra toes, extra laces, deformed, blurry, noisy, overexposed, underexposed, low-res, jpeg artifacts, bad anatomy, cropped, duplicated, nsfw`,
    width: 1024, height: 1024, steps: 4, guidance: 2.0
  },
  basketball: {
    name: '籃球鞋（高筒 / 室內木地板）',
    prompt: `High-top basketball sneaker design, leather + knit collar, colorway royal blue & white & gum sole, bold ankle support, herringbone outsole for indoor court grip, logo-free, dramatic 45-degree product view on parquet wood floor, studio softbox lighting, crisp edges, 4k`,
    negative: `logo, brand text, watermark, caption, deformed, blurry, noisy, low-res, jpeg artifacts, cropped, duplicated, nsfw`,
    width: 1024, height: 1024, steps: 5, guidance: 2.2
  },
  trail: {
    name: '越野跑（戶外濕石）',
    prompt: `Trail running sneaker design, ripstop + rubberized toe cap, muted olive & ochre with orange laces, deep lug outsole, protective overlays, logo-free, 3/4 angle on wet rock outdoor scene, soft overcast lighting, subtle mud specks, high detail`,
    negative: `logo, brand text, watermark, caption, unrealistic mud splashes, deformed, blurry, low-res, jpeg artifacts, cropped, duplicated, nsfw`,
    width: 1024, height: 1024, steps: 5, guidance: 2.0
  },
  lifestyle: {
    name: '生活鞋（極簡 / 商品攝影）',
    prompt: `Minimal lifestyle sneaker design, suede + canvas upper, pastel beige & mint colorway, clean cupsole, logo-free, 45-degree product shot on glossy white acrylic with subtle reflection, studio product photo, soft shadows, editorial lighting, 4k`,
    negative: `logo, brand text, watermark, caption, creases, scratches, dirt, deformed, blurry, low-res, jpeg artifacts, cropped, duplicated, nsfw`,
    width: 1024, height: 1024, steps: 4, guidance: 1.8
  },
  exploded: {
    name: '爆炸視圖（零件分解）',
    prompt: `Exploded view of athletic sneaker components: upper, insole, strobel board, midsole foam, shank plate, outsole rubber, laces, eyelets; isometric orthographic render, clean white background, technical diagram style, evenly spaced layers, ultra-detailed, logo-free`,
    negative: `logo, brand text, watermark, messy layout, overlapping layers, deformed, blurry, low-res, jpeg artifacts, cropped, duplicated, nsfw`,
    width: 1280, height: 960, steps: 6, guidance: 2.2
  },
  sketch: {
    name: '設計草圖（工業設計感）',
    prompt: `Athletic sneaker concept sketch, black ink linework with light grey shading, 3/4 view, construction lines visible, materials annotations, clean white background, logo-free, industrial design sheet`,
    negative: `logo, brand text, watermark, messy background, color fills, deformed, blurry, low-res, jpeg artifacts, cropped, duplicated, nsfw`,
    width: 1024, height: 768, steps: 6, guidance: 2.0
  }
};

function fill(d){
  fields.prompt.value = d.prompt || '';
  fields.negativePrompt.value = d.negativePrompt || '';
  fields.width.value = d.width || 1024;
  fields.height.value = d.height || 1024;
  fields.steps.value = d.steps || 4;
  fields.guidance.value = d.guidance ?? 2.0;
  fields.seed.value = d.seed ?? -1;
  fields.batch.value = d.batch || 1;
  fields.outDir.value = d.outDir || '';
}
function data(){
  return {
    prompt: fields.prompt.value.trim(),
    negativePrompt: fields.negativePrompt.value.trim(),
    width: Math.max(256, parseInt(fields.width.value,10) || 1024),
    height: Math.max(256, parseInt(fields.height.value,10) || 1024),
    steps: Math.min(50, Math.max(1, parseInt(fields.steps.value,10) || 4)),
    guidance: Math.max(0, parseFloat(fields.guidance.value) || 2.0),
    seed: parseInt(fields.seed.value,10) || -1,
    batch: Math.min(16, Math.max(1, parseInt(fields.batch.value,10) || 1)),
    outDir: fields.outDir.value.trim()
  };
}
function toast(t){ const el=$('#toast'); el.textContent=t; setTimeout(()=>el.textContent='',2500); }

async function boot(){
  const s = await window.EVI.getSettings();
  fill(s);
  badge.style.display = 'none';
  presetSel.value = '';
}
boot();

function applyPresetKey(key){
  if (!key || !PRESETS[key]) return;
  const p = PRESETS[key];
  fields.prompt.value = p.prompt;
  fields.negativePrompt.value = p.negative;
  fields.width.value = p.width;
  fields.height.value = p.height;
  fields.steps.value = p.steps;
  fields.guidance.value = p.guidance;
  // seed/batch 保留你的既有輸入
  badge.textContent = p.name;
  badge.style.display = 'inline-block';
  toast('已套用：' + p.name);
}

$('#applyPreset').addEventListener('click', ()=> applyPresetKey(presetSel.value));
$('#clearPreset').addEventListener('click', ()=>{
  presetSel.value = '';
  badge.style.display = 'none';
  toast('已切換到自訂模式');
});
presetSel.addEventListener('change', ()=> applyPresetKey(presetSel.value));

$('#pick').addEventListener('click', async ()=>{
  const p = await window.EVI.chooseDir(); if (p) { fields.outDir.value = p; }
});
$('#open').addEventListener('click', async ()=>{
  if (fields.outDir.value) await window.EVI.openPath(fields.outDir.value);
});
$('#reset').addEventListener('click', async ()=>{
  await window.EVI.saveSettings({}); const s = await window.EVI.getSettings(); fill(s); badge.style.display='none'; presetSel.value=''; toast('已恢復預設');
});
$('#save').addEventListener('click', async ()=>{
  await window.EVI.saveSettings(data()); toast('已儲存設定');
});
$('#back').addEventListener('click', ()=>{ window.location.replace('index.html'); });
</script>
</body>
</html>
